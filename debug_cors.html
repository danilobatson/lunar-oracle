<!DOCTYPE html>
<html>
<head>
    <title>LunarCrush CORS Debug</title>
</head>
<body>
    <h1>LunarCrush CORS Debug Tool</h1>
    <div id="results"></div>

    <script>
        const results = document.getElementById('results');

        function log(message) {
            results.innerHTML += `<p>${message}</p>`;
            console.log(message);
        }

        async function testCORS() {
            log('üîç Testing CORS to LunarCrush GraphQL endpoint...');

            const endpoint = 'https://lunarcrush.cryptoguard-api.workers.dev/graphql';
            const apiKey = 'xiewyr89anbiwnkyefnowoqezeme7ssdr5l86e6a';

            // Test 1: Simple OPTIONS request
            log('üìã Test 1: OPTIONS preflight request');
            try {
                const optionsResponse = await fetch(endpoint, {
                    method: 'OPTIONS',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    }
                });
                log(`‚úÖ OPTIONS status: ${optionsResponse.status}`);
                log(`‚úÖ OPTIONS headers: ${JSON.stringify([...optionsResponse.headers.entries()])}`);
            } catch (error) {
                log(`‚ùå OPTIONS failed: ${error.message}`);
            }

            // Test 2: Simple GET request
            log('üìã Test 2: GET request');
            try {
                const getResponse = await fetch(endpoint, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`
                    }
                });
                log(`‚úÖ GET status: ${getResponse.status}`);
                log(`‚úÖ GET headers: ${JSON.stringify([...getResponse.headers.entries()])}`);
            } catch (error) {
                log(`‚ùå GET failed: ${error.message}`);
            }

            // Test 3: GraphQL POST request
            log('üìã Test 3: GraphQL POST request');
            try {
                const graphqlQuery = {
                    query: `
                        query GetCoinsList {
                            getCoinsList(limit: 5) {
                                symbol
                                name
                                price
                                galaxy_score
                            }
                        }
                    `
                };

                const postResponse = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify(graphqlQuery)
                });

                log(`‚úÖ POST status: ${postResponse.status}`);
                log(`‚úÖ POST headers: ${JSON.stringify([...postResponse.headers.entries()])}`);

                if (postResponse.ok) {
                    const data = await postResponse.json();
                    log(`‚úÖ GraphQL data: ${JSON.stringify(data, null, 2)}`);
                } else {
                    const errorText = await postResponse.text();
                    log(`‚ùå POST error response: ${errorText}`);
                }
            } catch (error) {
                log(`‚ùå POST failed: ${error.message}`);
            }
        }

        // Run tests when page loads
        testCORS();
    </script>
</body>
</html>
